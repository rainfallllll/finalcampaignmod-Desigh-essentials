# 自生恢复
自生合金建造的单位建筑的特殊属性，一定限度内会为单位提供自动恢复
### 新属性
愈伤值：自生单位建筑自带的属性，字面愈合伤口   
自生能力：即建造花费的自生合金数与总数的比，也可以自己设定  
最适热量：即对象最适宜恢复的热量，默认为0
### 愈伤值特性
- 愈伤值由建造单位建筑时用的**自生合金**数量决定，一个自生合金对应一点愈伤值 
- 愈伤值是独立于单位生命值的数值，仅能被一些特殊攻击和debuff降低  
此外，所有自生合金的单位建筑，在 **恢复量超过自身生命的150% 并 这一期间没有受到过任何除本体以外的治疗** 时，会产生**瘤变效应**，将固定扣除25%的愈伤值
- 愈伤值回复需要非己治疗恢复，1%愈伤值需要本体5%最大生命值治疗量来恢复（相当于所有恢复效果都对愈伤值有80%的治疗削弱）  
当愈伤值低于上限时，来自非己的治疗对本体无效（愈伤值抵消了来自非己的治疗）
- 愈伤值为0时，会产生 **自身瓦解** ，每秒降低1.2%生命值，直到剩下20%
### 恢复上限
拥有愈伤值的单位，会缓慢恢复自身血量，但这个恢复量有上限，治疗达到一定比例的生命值后将不再恢复。这个上限会随着愈伤值的降低而降低，具体算法为：  
$$
最大恢复比例=0.8\cdot\frac{愈伤值}{愈伤值上限}（愈伤值比）+0.2
$$
即在根据愈伤比例，线性计算 **20%->100%** 最大恢复比例  
### 恢复速率（x点生命值/秒）
恢复速率受单位建筑的内因影响（当前愈伤值，自生能力），还受环境外因影响（温度，湿度，光照，受击状态）具体算法：  
受击状态限制在受击时的恢复速度，受击状态会在 **0.2->2** 之间变化，受击时，会重置到 0.2 ，并从 0.2 开始缓慢过渡到 2 ，持续3秒  
$$
恢复速率= 自生能力 \cdot 当前愈伤值 \cdot 受击状态 \cdot (1-|\frac{最适热量-热量}{10}|) \cdot (0.5+湿度) \cdot (1+光照度)
$$

当 $|最适热量-热量|>10$ 时，恢复速率=0  
且这时候，愈伤值会减少  
$$
降低速率 = 2（|最适热量-热量|-10）^2
$$



